<!DOCTYPE html>
<html>
<head>
    <title> single cube</title>

    <link rel="stylesheet" href="../libs/css/gbox3d.three.css"/>

    <style>

        .anim-cube-roll {
            -webkit-animation-name: cuberoll;
            -webkit-animation-duration: 1s;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-timing-function: linear;
        }



        @-webkit-keyframes cuberoll {
            from {
                -webkit-transform:rotateY(0deg);
            }
            50% {
                -webkit-transform:rotateY(180deg);
            }
            to{
                -webkit-transform:rotateY(360deg);
            }
        }



    </style>


    <script src='../libs/thressjs/three.js'></script>
    <script src='../libs/thressjs/gbox3d.CSS3DObject.js'></script>
    <script src='../libs/thressjs/gbox3d.ext.three.js'></script>
    <script src='../libs/thressjs/CSS3DRenderer.js'></script>
    <script src='../libs/thressjs/gbox3d.CSS3DPerspCamera.js'></script>
    <script src='../libs/thressjs/gbox3d.CSS3DScene.js'></script>

    <script>



        window.onload = function() {

            var renderer = new THREE.CSS3DRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );


            var camera = new THREE.CSS3DPerspectiveCamera(
                    {
                        fov : 90,
                        aspect : window.innerWidth / window.innerHeight,
                        near : 1,
                        far : 1000,
                        element : renderer.cameraElement
                    }
            );
            camera.position.set(0,300,500);
            camera.lookAt( new THREE.Vector3(0,0,0) );

            var scene = new THREE.CSS3DScene({
                camera:camera
            });

            var rootObj = new THREE.CSS3DObject( document.querySelector('#root-obj') );
            rootObj.position.set(0,0,0);
            scene.add(rootObj);

            var element = document.querySelector('#cube');

            var object = new THREE.CSS3DObject( element );
            object.position.set(0,0,0);
            rootObj.add( object );


            var count=0

            var hid = setInterval(function() {

                for(i=0;i<5;i++) {
                    var clone_object = object.clone();
                    clone_object.position.set(-400 + (i*200),0,
                            -200 * (count+1)
                            );
                    clone_object.updateMatrix();
                    rootObj.add( clone_object );

                }


                count++;
                if(count > 16) {
                    clearInterval(hid);
                }
            },500)




            renderer.render( scene, camera );


            function callbackControl(movementX,movementY) {
//                var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
//                var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

                //항상 (1,0,0)(0,1,0) 기준으로 만 회전한다.
                var rotM = (new THREE.Matrix4()).setRotationFromEuler(new THREE.Vector3(movementY*0.01,movementX*0.01,0));

                //인자로 넘겨준 매트릭스를 자기 메트릭스 곱해서 적용한다.
                //applyMatrix 는 인자로 넘겨준 메트릭스정보를 가지고 변환정보와 내부변환 행렬을  갱신해준다.
                //updateMatrix 는 현재 가지고있는 변환 정보를 가지고 내부변환 행렬을 다시 갱신한다.
                rootObj.applyMatrix(rotM);
                rootObj.updateCSS();
            }


            //이벤트처리
            document.addEventListener( 'mousedown', onDocumentMouseDown, false );
            window.addEventListener( 'resize', onWindowResize, false );

            function onWindowResize() {

                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.render( scene, camera );

            }

            function onDocumentMouseDown( event ) {

                event.preventDefault();

                document.addEventListener( 'mousemove', onDocumentMouseMove, false );
                document.addEventListener( 'mouseup', onDocumentMouseUp, false );

            }

            function onDocumentMouseMove( event ) {

                var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
                var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

                callbackControl(movementX,movementY);
            }

            function onDocumentMouseUp( event ) {

                document.removeEventListener( 'mousemove', onDocumentMouseMove );
                document.removeEventListener( 'mouseup', onDocumentMouseUp );

            }

            //터치 디바이스
            document.addEventListener( 'touchstart', onDocumentTouchStart, false );
            document.addEventListener( 'touchmove', onDocumentTouchMove, false );

            var touchX,  touchY;

            function onDocumentTouchStart( event ) {

                event.preventDefault();

                var touch = event.touches[ 0 ];

                touchX = touch.screenX;
                touchY = touch.screenY;

            }

            function onDocumentTouchMove( event ) {

                event.preventDefault();

                var touch = event.touches[ 0 ];

                var movementX =  (touchX - touch.screenX);
                var movementY =  (touchY - touch.screenY);
                touchX = touch.screenX;
                touchY = touch.screenY;

                callbackControl(movementX,movementY);
            }
        }

    </script>

</head>
<body>


<div id='root-obj' ></div>

<div id='cube' class="css3dobj">

    <div  class="css3dobj anim-cube-roll">

        <div
                class="css3dobj"
                style="
                background-image: url(../res/t351sml.jpg);
                width: 128px;
                height: 128px;

                -webkit-transform : translate3d(-50%,-50%,0) translate3d(0px,0px,64px);
                -moz-transform : translate3d(-50%,-50%,0) translate3d(0px,0px,64px);
            ">

        </div>

        <div
                class="css3dobj"
                style="
                background-image: url(../res/t351sml.jpg);
                width: 128px;
                height: 128px;

                -webkit-transform : translate3d(-50%,-50%,0) translate3d(64px,0px,0px) rotateY(90deg);
                -moz-transform : translate3d(-50%,-50%,0) translate3d(64px,0px,0px) rotateY(90deg);
            ">

        </div>

        <div
                class="css3dobj"
                style="
                background-image: url(../res/t351sml.jpg);
                width: 128px;
                height: 128px;

                -webkit-transform : translate3d(-50%,-50%,0) translate3d(-64px,0px,0px) rotateY(-90deg);
                -moz-transform : translate3d(-50%,-50%,0) translate3d(-64px,0px,0px) rotateY(-90deg);
            ">

        </div>

        <div
                class="css3dobj"
                style="
                background-image: url(../res/t351sml.jpg);
                width: 128px;
                height: 128px;

                -webkit-transform : translate3d(-50%,-50%,0) translate3d(0px,0px,-64px) rotateY(180deg);
                -moz-transform : translate3d(-50%,-50%,0) translate3d(0px,0px,-64px) rotateY(180deg);
            ">

        </div>

        <div
                class="css3dobj"
                style="
                background-image: url(../res/t351sml.jpg);
                width: 128px;
                height: 128px;

                -webkit-transform : translate3d(-50%,-50%,0) translate3d(0px,-64px,0px) rotateX(90deg);
                -moz-transform : translate3d(-50%,-50%,0) translate3d(0px,-64px,0px) rotateX(90deg);
            ">

        </div>

        <div
                class="css3dobj"
                style="
                background-image: url(../res/t351sml.jpg);
                width: 128px;
                height: 128px;

                -webkit-transform : translate3d(-50%,-50%,0) translate3d(0px,64px,0px) rotateX(-90deg);
                -moz-transform : translate3d(-50%,-50%,0) translate3d(0px,64px,0px) rotateX(-90deg);
            ">

        </div>


    </div>


</div>



</body>
</html>