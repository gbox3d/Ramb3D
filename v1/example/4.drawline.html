<!DOCTYPE html>
<html>
<head>
    <title></title>

    <style>
        .css3dobj {
            position: absolute;
            -webkit-transform-style: preserve-3d;
            -webkit-backface-visibility : hidden;
        }
    </style>

    <script src='../libs/jquery-1.9.1.min.js'></script>

    <script src='../libs/thressjs/three.js'></script>
    <script src='../libs/thressjs/gbox3d.CSS3DObject.js'></script>
    <script src='../libs/thressjs/gbox3d.ext.three.js'></script>
    <script src='../libs/thressjs/CSS3DRenderer.js'></script>
    <script src='../libs/thressjs/gbox3d.CSS3DPerspCamera.js'></script>
    <script src='../libs/thressjs/gbox3d.CSS3DScene.js'></script>

    <script>

        function makeLineGeoMetry(start,end,object) {

            //중점구하기
            var center = new THREE.Vector3();
            center.addVectors(start,end);
            center.multiplyScalar(0.5);

            //방향벡터 만들기
            var norVec = new THREE.Vector3();
            norVec.subVectors(end,start);
            norVec.normalize();

            //var baseVec = new THREE.Vector3(0,0,1);
            //console.log( norVec);
            //console.log( norVec.getHorizontalAngle() );

            //그려질 선의  중점에 놓고 방향 잡아주기
            object.position.copy(center);
            object.eulerOrder = 'YXZ';
            object.rotation.x = THREE.Math.degToRad(norVec.getHorizontalAngle().x);
            object.rotation.y = THREE.Math.degToRad(norVec.getHorizontalAngle().y);
            object.updateMatrix();

            //선 길이 조절
            var lineDist = start.distanceTo(end);
            $(object.element).css('height',lineDist+'px');
            $('line',$(object.element)).attr('y2',lineDist);
        }


        $(function() {

            var renderer = new THREE.CSS3DRenderer();
            renderer.domElement.style.backgroundColor="#9966FF";   //배경컬러지정
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.domElement.style.backgroundColor =
                    document.body.appendChild( renderer.domElement );

            var camera = new THREE.CSS3DPerspectiveCamera(
                    {
                        fov : 90,
                        aspect : window.innerWidth / window.innerHeight,
                        near : 1,
                        far : 1000,
                        element : renderer.cameraElement
                    }
            );
            camera.position.set(300,300,500);
            camera.lookAt( new THREE.Vector3(0,0,0) );


            var scene = new THREE.CSS3DScene({
                camera:camera

            });

            var  object = new THREE.CSS3DObject( {
                element: document.querySelector('#test-root')
            } );
            object.position.set(0,0,0);
            scene.add( object );


            var grid_object = new THREE.CSS3DObject( {
                element: document.querySelector('#grid')
            } );
            grid_object.position.set(0,0,0);
            object.add( grid_object );

            var line_obj = new THREE.CSS3DObject( {
                element: document.querySelector('#line')
            } );
            line_obj.position.set(0,0,0);
            object.add(line_obj);

            makeLineGeoMetry(new THREE.Vector3(45,70,0),new THREE.Vector3(200,0,0),line_obj);

            var line_obj_clone = line_obj.clone();
            object.add(line_obj_clone);
            makeLineGeoMetry(new THREE.Vector3(200,0,0),new THREE.Vector3(30,30,40),line_obj_clone);

            line_obj_clone = line_obj.clone();
            object.add(line_obj_clone);
            makeLineGeoMetry(new THREE.Vector3(30,30,40),new THREE.Vector3(45,70,0),line_obj_clone);


            var testVect = new THREE.Vector3(1,0,1);
            testVect.normalize();
            console.log(testVect.getHorizontalAngle());


            renderer.render( scene, camera );

            //이벤트처리
            document.addEventListener( 'mousedown', onDocumentMouseDown, false );

            window.addEventListener( 'resize', onWindowResize, false );

            function onWindowResize() {

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize( window.innerWidth, window.innerHeight );
                renderer.render( scene, camera );

            }

            function onDocumentMouseDown( event ) {

                event.preventDefault();

                document.addEventListener( 'mousemove', onDocumentMouseMove, false );
                document.addEventListener( 'mouseup', onDocumentMouseUp, false );

            }

            function onDocumentMouseMove( event ) {

                var movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
                var movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;

                object.rotation.y += movementX * 0.01;
                object.rotation.x -= movementY * 0.01;

                //매트릭스 css3 적용
                object.updateMatrix();

            }

            function onDocumentMouseUp( event ) {

                document.removeEventListener( 'mousemove', onDocumentMouseMove );
                document.removeEventListener( 'mouseup', onDocumentMouseUp );

            }

        });

    </script>

</head>
<body style="margin: 0px;">

<div id='test-root'></div>

<div id='grid'

        style="width: 200px; height:  200px;">

    <svg
            style="position: absolute;"
            xmlns="http://www.w3.org/2000/svg" version="1.1"
            >
        <line x1="0" y1="0" x2="200" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="0" y1="0" x2="0" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="0" y1="0" x2="200" y2="0"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="200" y1="0" x2="0" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="200" y1="0" x2="200" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="0" y1="200" x2="200" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>

        <line x1="100" y1="0" x2="100" y2="200"
              style="stroke:rgb(255,255,0);stroke-width:1"/>

    </svg>

    <svg
            xmlns="http://www.w3.org/2000/svg" version="1.1"
            style="
            position: absolute;
            -webkit-transform:rotateX(90deg);"

            >
        <line x1="0" y1="0" x2="200" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="0" y1="0" x2="0" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="0" y1="0" x2="200" y2="0"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="200" y1="0" x2="0" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="200" y1="0" x2="200" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>
        <line x1="0" y1="200" x2="200" y2="200"
              style="stroke:rgb(255,0,0);stroke-width:1"/>

        <line x1="100" y1="0" x2="100" y2="200"
              style="stroke:rgb(255,255,0);stroke-width:1"/>

    </svg>

</div>

<div id='line'
        style="width: 10px; height:  100px;"

        >

    <svg
            style="position: absolute;
            -webkit-transform: rotateX(90deg);

            "
            xmlns="http://www.w3.org/2000/svg" version="1.1"
            >
        <line x1="5" y1="0" x2="5" y2="100"
              style="
              stroke:rgb(0,255,0);
              stroke-width:5"/>

    </svg>

</div>



</body>
</html>